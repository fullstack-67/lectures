---
marp: true
theme: default
class:
  - invert
author: Nirand Pisutha-Arnond
paginate: true
footer: "261497: Fullstack Development"
---

<style>
@import url('https://fonts.googleapis.com/css2?family=Prompt:ital,wght@0,100;0,300;0,400;0,700;1,100;1,300;1,400;1,700&display=swap');

    :root {
    font-family: Prompt;
    --hl-color: #D57E7E;
}
h1 {
  font-family: Prompt
}
</style>

# Fullstack Development

---

# Fullstack Landscape

> How to over-engineer "todo" apps

---

# 5 Ways to make Todo apps

- Multi-Page Applications (MPA)
- Single-Page Applications (SPA)
- React Server Components (RSC)
- RSC + Client Components (React's New Architecture)
- HTMX

---

# Round 1

> Multi-Page Application (MPA) vs Single-Page Application (SPA)

---

# Multi-page application

- Loads a new page every time you perform an action.
- Traditional web applications.
- Use server-side technologies
  - PHP, Ruby on Rails, ASP.NET, Java, and Node JS.
- Can include JavaScript (`script`) for client-side interactivity

---

![width:900](./img/mpa.jpg)

---

# Todo app (MPA)

- `Express JS` + `Pug` (renderer)

---

# Get started

- `npm install -g pnpm`
  - I am using `pnpm`.
- `git clone -b mpa https://github.com/fullstack-67/landscape-server`
- `cd landscape-server`
- `pnpm install`
- `npm run dev`

---

# Endpoint

`./src/index.ts`

```ts
app.get("/", async (req, res) => {
  const message = req.query?.message ?? "";
  const todos = await getTodos();
  // Output HTML
  res.render("pages/index", {
    todos,
    message,
    mode: "ADD",
    curTodo: { id: "", todoText: "" },
  });
});
```

---

# Renderer

`./view/pages/index.pug`

```ts
body
    main(class="container")
        a(href="/")
            h1 Todo (MPA)
        div(id="todoform")
            include ../components/inputform.pug
        div(id="todolist")
            include ../components/todolist.pug
```

---

![width:1000](./img/mpa_loading.jpg)

_Use incognito mode to avoid loading chrome extensions._

---

# Note

- Every button is wrapped in a separate form
  - Need to trigger different endpoints.
- Need to use `input(type="hidden)` to encode additional information.

```js
form(action="/delete" method="POST" style="display: contents")
  input(type="hidden" value=`${todo.id}` name="curId")
  button(type="submit" class="contrast" style="margin-bottom: 0") üóëÔ∏è
form(action="/edit" method="POST" style="display: contents")
  input(type="hidden" value=`${todo.id}` name="curId")
  button(type="submit" class="secondary" style="margin-bottom: 0") üñäÔ∏è
```

---

![](./img/mpa_type.png)

---

# Single-page application

- Single-page application
  - Loads a single HTML page and dynamically updates the content as the user interacts with the app.
- Use frontend and backend frameworks separately.

---

![width:900](./img/spa.jpg)

---

# Todo app (SPA)

- `Express JS` + `React`

---

# Get started

- `git clone https://github.com/fullstack-67/landscape-spa`
- Backend
  - `cd backend`
  - `pnpm install`
  - `npm run dev`
- Frontend
  - `cd frontend`
  - `pnpm install`
  - `npm run build`
  - `npm run preview`

---

![width:1000](./img/spa_loading.jpg)

---

![](./img/spa_type.png)

---

# Global store

- `zustand`
  ![width:700](./img/global_store.png)

---

# App comparison (UX)

| Item              | MPA | SPA |
| ----------------- | --- | --- |
| No page-refresh   | ‚ùå  | ‚úÖ  |
| Spinner           | ‚ùå  | ‚úÖ  |
| Element disabling | ‚ùå  | ‚úÖ  |

---

# App comparison (technical)

| Item                  | MPA | SPA |
| --------------------- | --- | --- |
| Amount of `JS` loaded | ‚úÖ  | ‚ùå  |
| HTML content (SEO)    | ‚úÖ  | ‚ùå  |
| State in URL          | ‚úÖ  | ‚ùå  |

---

# DX

| Item                 |        MPA |     SPA |
| -------------------- | ---------: | ------: |
| Number of frameworks |       1 ‚úÖ |    2 ‚ùå |
| Complexity           |    Less ‚úÖ | More ‚ùå |
| Lines of code        |    Less ‚úÖ | More ‚ùå |
| Type Safety          |    Less ‚ùå | More ‚úÖ |
| Hot reloading        | Partial ‚ùå | Full ‚úÖ |

---

# Amount of Codes

| Dir              | # Files | Total Lines |
| :--------------- | ------: | ----------: |
| _MPA_            |         |             |
| `./src`          |       2 |         161 |
| `./views`        |       3 |          42 |
| _SPA_            |         |             |
| `./backend/src`  |       2 |         144 |
| `./frontend/src` |      10 |      üò≠ 360 |

---

# Round 2

> Back to the server. (Next JS)

---

# Server-Side Rendering (SSR)

- `SSR`
  - Generating the HTML for a web page on the server before sending it to the client‚Äôs browser.
- `CSR` (Client-Side Rendering)
  - Browser loads a minimal HTML file and fetches and renders the content using JavaScript.
- See this [explanation](https://www.joshwcomeau.com/react/server-components/?utm_source=pocket_shared#bouncing-back-and-forth-2).

---

# Next JS

- `V12`
  - "Full SSR" (_with DB query_) can only be done through top-level component (_page level_).
  - Use `getServerSideProps` function.
- `V13` (and above)
  - Full SSR can be done through a special components called
    - [_React Server Components_](https://www.joshwcomeau.com/react/server-components/).

---

# Server component

- Run _exclusively_ on the server.
- Generate static HTML.
  - No interactivity (event handlers)
- It's code isn't included in the JS bundle.
  - Never re-render.
  - Output is static without change in router level.
- No hook
  - `useState`, `useEffect` üòç

---

# Server component

![](./img/php.png)
[Link](https://www.reddit.com/r/reactjs/comments/150ynj8/arent_react_server_components_just_html_and/?utm_source=share&utm_medium=web3x&utm_name=web3xcss&utm_term=1&utm_content=share_button)

---

# Client component

- The "standard" React components we're familiar with.
- Client Components render on _both_ the client and the server.
  - _Still have SSR._

|                  | Render on server? | Render on client? |
| ---------------- | :---------------: | :---------------: |
| Server Component |        ‚úÖ         |                   |
| Client Component |        ‚úÖ         |        ‚úÖ         |

---

# Why server component?

- First "official" way to run server-exclusive code in React.
- Performance
  - Server Components don't get included in our JS bundles.
  - [Faster load time](https://www.joshwcomeau.com/react/server-components/?utm_source=pocket_shared#advantages-9)
  - [Real use-case](https://bright.codehike.org/)
- Less complications
  - Dependency arrays, stale closures, memoization, ...
  - _(All of these are caused by things changing.)_

---

# Missing piece

### React

> _If RSC output is static, how can I mutate data then?_

---

# Missing piece

### React

> _If RSC output is static, how can I mutate data then?_

### PHP

> _I had solved this problem before you were born, kid._

---

![width:800](./img/form_action.png)
[Link](https://www.w3schools.com/tags/att_form_action.asp)

---

# React's new architecture

- Client component
- Server component
- Server action
  - Asynchronous functions that are executed on the server.
  - Alternative to [API routes](https://nextjs.org/docs/app/building-your-application/routing/route-handlers).

---

# Server Action vs API Route

![width:900](./img/server_action.png)

---

# Form action

- No need to define new endpoints.
- Accept `form-data`
- Colocation
  - Type safe
  - Can "bind" data that is passed thought components' props. ü§Ø
- Can trigger RSC update without refreshing page. üëç

---

# Todo App (RSC Only)

- `git clone -b rsc-only https://github.com/fullstack-67/landscape-hybrid.git`
- `cd landscape-hybrid`
- `pnpm install`
- `npm run build`
- `npm run start`

---

# Server components

`./src/app/page.tsx`

```ts
export default async function Home({ params, searchParams }: PageProps) {
  const todos = await getTodos();
  //...
  return <main className="container">...</main>;
}
```

- Async function
- Data fetching without `useEffect`.
  - It only runs once on the _server_. (Try `console.log`)
- Returns HTML to client.

---

# Server Action

`./src/components/FormInput.tsx` _(Slightly modified)_

```tsx
export const FormInput: FC<Props> = async ({ message, mode, curId }) => {
  async function actionCreateTodo(formData: FormData) {
    "use server";
    const todoText = formData.get("todoText") as string; // Receive form-data
    await createTodos(todoText); // DB stuff
    revalidatePath("/"); // Change RSC content without refreshing
  }

  return (
    <form action={actionCreateTodo} style={{ display: "contents" }}>
      <input type="hidden" name="curId" value={curId ?? ""} />
      <button type="submit">{mode === "ADD" ? "Submit" : "Update"}</button>
    </form>
  );
};
```

---

`./src/components/TodoList.tsx`

```tsx
const ButtonDelete: FC<{ todo: Todo }> = ({ todo }) => {
  async function actionDeleteTodo(formData: FormData) {
    "use server";
    await deleteTodo(todo.id);
    revalidatePath("/");
  }
  return (
    <form action={actionDeleteTodo}>
      <button type="submit">üóëÔ∏è</button>
    </form>
  );
};
```

- "Binding" `todo` in the server action
- No need to use `form-data`. Type safety!
- No need to include hidden input field.

---

# Missing UX/DX

- `UX`
  - Form not resetting after submission.
  - Page refresh when changing "client" states (error messsage).
  - No loading spinner
- `DX`
  - Client state is accessed from url. (`searchParam` in `page.tsx`)
    - Not type safety. Need validation.
  - Still need to include hidden input field (Update Button).

---

# Round 3

> Enlightment

---

# Hypermedia-driven application - HTMX
