---
marp: true
theme: default
class:
  - invert
author: Nirand Pisutha-Arnond
paginate: true
footer: "261497: Fullstack Development"
---

<style>
@import url('https://fonts.googleapis.com/css2?family=Prompt:ital,wght@0,100;0,300;0,400;0,700;1,100;1,300;1,400;1,700&display=swap');

    :root {
    font-family: Prompt;
    --hl-color: #D57E7E;
}
h1 {
  font-family: Prompt
}
</style>

# Fullstack Development

---

# Authentication / Authorization

---

## Authentication

- A process of verifying user identity.
- Who is the user?
- Is the user really who he/she represents himself to be?

## Authorization

- A process of verifying a userâ€™s access level.
- Is user `X` authorized to access resource `R`?
- Is user `X` authorized to perform operation `P`?

---

# Let's think about it.

- User signing in with username/password.
  - `Authen` (`App`'s view)
- User signing in with Google account.
  - `Authen` (`App`'s view)
  - `Author` (`Google`'s view, `user`=`App`)
    - OAuth 2
- User requesting profile page.
  - `Author` (role-protected route)
  - `Authen` (query for user to display information)

---

# Part 1: Signing up/in with credential

---

> Part 1: Signing up/in with credential

# Section 1A: How to store password

---

# Situation

- User fill in username and password.
- Your app creates user entry in database.
- _How do you store password?_

---

# 6 levels of safety

| Technique                        | Ranking | Vunerability         |
| :------------------------------- | :-----: | :------------------- |
| Plain text                       |    F    | All                  |
| Encryption                       |    D    | Stolen key           |
| Hashing                          |    C    | Rainbow table attack |
| Salting                          |    B    | Fast computer        |
| Salting + Cost Factor (`bcrypt`) |   B+    | _Infinity stone_ ðŸ¤£  |
| ?                                |    A    |                      |

Adapted from [source](https://youtu.be/qgpsIBLvrGY?si=bDSXaifIQ5aBjPyY)

---

# Note

- [SHA256](https://emn178.github.io/online-tools/sha256.html)
- [Rawinbow table attack](https://en.wikipedia.org/wiki/Dictionary_attack#Pre-computed_dictionary_attack/Rainbow_table_attack)
- `bcrypt` hash

![width:900](./img/bcrypt_hash.png)

---

# `bcrypt` example

- `git clone -b bcrypt https://github.com/fullstack-67/auth-mpa-v2.git auth-bcrypt`
- `pnpm i`
- `npx tsx ./src/hash.ts`
- `npx tsx ./src/compare.ts`

---

> Part 1: Signing up/in with credential

# Section 1B: Implementation with `passport`

---

# `passport`

- Most popular authentication middleware for `express`.
- Minimal and modular
- [500+ strategies](https://www.passportjs.org/) (click at button)
- Confusing and [poor documented](https://www.reddit.com/r/node/comments/vbuv2s/passportjs_alternatives_in_2022/?rdt=52617) ðŸ¤£
  - [Hidden manual](https://github.com/jwalton/passport-api-docs)

---

# Let's see it

- `git clone -b signin-credential https://github.com/fullstack-67/auth-mpa-v2.git auth-signin-credential`
- `pnpm i`
- `npm run db:reset`
- `npm run dev`

---

# Side note about the project

- MPA - HTMX
- Use `SQLite` + `drizzle`.
  - Checkout the schema.
- Use `debug` package.
- Try debugging in VSCode.
  - See `launch.json`.

---

# Highlighed packages

`package.json`

```json
{
  "passport": "^0.7.0",
  "passport-local": "^1.0.0"
}
```

---

# Middleware

`src/index.ts`

```ts
passport.use(
  new LocalStrategy(
    {
      // Options
    },
    async function (email, password, done) {
      // Verify email / password
    }
  )
);
//
app.use(passport.initialize());
```

[Available options](https://github.com/jaredhanson/passport-local?tab=readme-ov-file#available-options)

---

# Route

```ts
app.post(
  "/login",
  passport.authenticate("local", { session: false }),
  function (req, res) {
    // * Passport will attach user object in the request
  }
);
```

---

![](./img/credential1.png)

---

# Part 2: Social signing up/in

---

> Part 2: Social signing up/in

# Section 2A: OAuth 2.0

---

# OAuth 2.0

- "Open Authorization"
- Standard designed to allow application to access resources hosted by other web apps on behalf of a user.
  - Standard for `author`
  - Not for `authen`
- Replaced OAuth 1.0 in 2012.

---

# The app is using OAuth standard.

![bg right:50% contain](./img/consent_screen.png)

---

---

# Resources

- https://engineering.backmarket.com/oauth2-explained-with-cute-shapes-7eae51f20d38

- https://developer.okta.com/blog/2019/10/21/illustrated-guide-to-oauth-and-oidc?utm_source=pocket_shared

- https://youtu.be/8aCyojTIW6U?si=YPxkcLPcAoK5jixI

- https://youtu.be/t18YB3xDfXI?si=pD1JnFP0GrnBXW2v
